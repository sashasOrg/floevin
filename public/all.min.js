angular.module("SashasApp",["ui.router","ngCookies"]),angular.module("SashasApp").config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/",templateUrl:"/home.html",controller:"mainController",access:{restricted:!1}}).state("form",{url:"/form",templateUrl:"/form.html",controller:"formController",access:{restricted:!1}}).state("login",{url:"/login",templateUrl:"/login.html",controller:"loginController",access:{restricted:!1}}).state("register",{url:"/register",templateUrl:"/register.html",controller:"registerController",access:{restricted:!1}}).state("portfolio",{url:"/portfolio",templateUrl:"/portfolio.html",controller:"userController",access:{restricted:!1}}).state("stock",{url:"/stock",templateUrl:"/stock.html",controller:"mainController",access:{restricted:!1}}).state("fundtable",{url:"/fundtable",templateUrl:"/fundtable.html",controller:"formController",access:{restricted:!1}}).state("fundinfo",{url:"/fundinfo",templateUrl:"/fundinfo.html",controller:"fundController",access:{restricted:!1}}).state("admin",{url:"/admin",templateUrl:"/admin.html",controller:"formController",access:{restricted:!1}}),e.otherwise("/")}]),angular.module("SashasApp").run(["$state","$rootScope","$location","AuthService",function(t,e,r,l){e.$on("$stateChangeStart",function(e,r,o){l.getUserStatus(),r.access.restricted&&!l.isLoggedIn()&&(e.preventDefault(),t.go("login"))})}]);
angular.module("SashasApp").factory("AuthService",["$q","$timeout","$http","$state","$cookies",function(e,r,s,t,u){function n(){return null===JSON.stringify(u.get("currentUser"))?user=null:user=!0,!!user}function o(){s.get("/user/status").success(function(e){e.status?user=!0:user=!1}).error(function(e){user=!1})}function c(r,t){var n=e.defer();return s.post("/user/login",{username:r,password:t}).success(function(e,r){200===r&&e.status?(user=!0,console.log(u.get("currentUser")),n.resolve(e.user)):(user=!1,n.reject())}).error(function(e){user=!1,n.reject()}),n.promise}function i(){var r=e.defer();return s.get("/user/logout").success(function(e){user=!1,u.remove("currentUser"),r.resolve()}).error(function(e){user=!1,r.reject()}),r.promise}function a(r,t,u,n,o){var c=e.defer();return s.post("/user/register",{username:r,password:t,firstName:u,lastName:n,email:o}).success(function(e,r){200===r&&e.status?c.resolve():c.reject()}).error(function(e){c.reject()}),c.promise}return this.currentUser=u.get("currentUser"),{isLoggedIn:n,getUserStatus:o,login:c,logout:i,register:a}}]);
angular.module("SashasApp").service("formService",["$http","$q","$cookies",function(n,t,u){this.getFund=function(){return n.get("/fund")},this.newFund=function(t){console.log(t),n.post("/fund",t)},this.fundQuery=function(t){return n.get("/fund/specific?id="+t)},this.updateFund=function(t){return n.put("/fund"+t,update)},this.deleteFund=function(t){n({method:"DELETE",url:"/fund?id="+t}).then(function(n){return n},function(n){return n})}}]);
angular.module("SashasApp").service("mainService",["$http","$q","$cookies",function(e,t,o){this.data=[],this.searchSymbols=function(t){return e.jsonp("http://d.yimg.com/aq/autoc?query="+t+"&region=US&lang=en-US&callback=JSON_CALLBACK")},this.getMoreInformation=function(t){return e.get("http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20IN%20(%22"+t+"%22,%22"+t+"%22)&format=json&env=http://datatables.org/alltables.env")},this.updateUser=function(t){return e.put("user?id="+JSON.parse(o.get("currentUser"))._id,t)},this.getUserPortfolio=function(t){return e.get("user/portfolio?username="+t)}}]);
angular.module("SashasApp").controller("loginController",["$state","$scope","$location","$cookies","AuthService","mainService",function(e,r,o,n,t,i){r.isLoggedIn=t.isLoggedIn,r.login=function(){r.error=!1,r.disabled=!0,t.login(r.loginForm.username,r.loginForm.password).then(function(o){r.disabled=!1,r.loginForm={},t.isLoggedIn(),n.remove("currentUser"),n.put("currentUser",JSON.stringify(o)),i.getUserPortfolio(JSON.parse(n.get("currentUser")).username).then(function(r){console.log("response two",r),n.remove("currentUserPortfolio"),n.put("currentUserPortfolio",JSON.stringify(r.data)),e.go("portfolio")})})["catch"](function(){r.error=!0,r.errorMessage="Invalid username and/or password",r.disabled=!1,r.loginForm={}})}}]),angular.module("SashasApp").controller("logoutController",["$scope","$location","$cookies","AuthService","mainService",function(e,r,o,n,t){e.userLogged=n.isLoggedIn(),e.$watch(e.userLogged),e.logout=function(){n.logout().then(function(){o.remove("currentUser"),o.remove("currentUserPortfolio"),r.path("login")}),console.log("logout")}}]),angular.module("SashasApp").controller("registerController",["$scope","$location","AuthService",function(e,r,o){e.register=function(){e.error=!1,e.disabled=!0,o.register(e.registerForm.username,e.registerForm.password,e.registerForm.firstName,e.registerForm.lastName,e.registerForm.email).then(function(){r.path("login"),e.disabled=!1,e.registerForm={}})["catch"](function(){e.error=!0,e.errorMessage="Something went wrong!",e.disabled=!1,e.registerForm={}})}}]);
angular.module("SashasApp").controller("formController",["$scope","$cookies",function(e,o){e.Clock_dg=function(e){var o=6,t=new Date,n=t.getHours();n>12&&(n-=12),hour=n,minute=t.getMinutes(),second=t.getSeconds(),hourAngle=30*hour+.5*minute,$("#minute")[0].style[e]="rotate("+o*minute+"deg)",$("#second")[0].style[e]="rotate("+o*second+"deg)",$("#hour")[0].style[e]="rotate("+hourAngle+"deg)"},$(function(){for(var e,o="asdfghjkl WebkitTransform MozTransform OTransform msTransform".split(" "),t=document.createElement("div"),n=0,r=o.length;r>n;n++)if("undefined"!=typeof t.style[o[n]]){e=o[n];break}setInterval(function(){Clock_dg(e)},100)})}]);
angular.module("SashasApp").controller("formController",["$scope","$cookies",function(e,n){e.age_answer=[],e.age_answer[30]=5,e.age_answer[3040]=4,e.age_answer[4050]=3,e.age_answer[5065]=2,e.age_answer[65]=1,e.objective_answer=[],e.objective_answer.Spec=2,e.objective_answer.Growth=1,e.objective_answer.Income=-1,e.objective_answer.Tax=-3,e.objective_answer.Safety=-4,e.income_answer=[],e.income_answer.I50=-4,e.income_answer.I50100=-3,e.income_answer.I100250=-2,e.income_answer.I250500=0,e.income_answer.I500=1,function(n){e.data={repeatSelect:null,availableOptions:[{id:"...",name:""},{id:"Risk potential: 1",name:"None"},{id:"Risk potential: 2",name:"Limited"},{id:"Risk potential: 3",name:"Average"},{id:"Risk potential: 4",name:"Acceptable"},{id:"Risk potential: 5",name:"Extensive"}]}}(window.angular),e.getAge=function(){for(var n=0,a=document.forms.form,t=a.elements.ageselected,o=0;o<t.length;o++)if(t[o].checked){n=e.age_answer[t[o].value];break}return n},e.getObjective=function(){for(var n=0,a=document.forms.form,t=a.elements.objectiveselected,o=0;o<t.length;o++)if(t[o].checked){n=e.objective_answer[t[o].value];break}return n},e.getIncome=function(){for(var n=0,a=document.forms.form,t=a.elements.incomeselected,o=0;o<t.length;o++)if(t[o].checked){n=e.income_answer[t[o].value];break}return n},e.calculateTotal=function(){var n=e.getAge()+e.getObjective()+e.getIncome();if(1>n)return n=1;if(n>5)return n=5;var a=document.getElementById("totalRisk");a.style.display="block",a.innerHTML="We recommend taking level: "+n+" risk"},e.hideTotal=function(){var e=document.getElementById("totalRisk");e.style.display="none"}}]);
angular.module("SashasApp").controller("fundController",["$scope","formService",function(n,e){n.seachFund="",n.anyfund=function(){console.log("test"),n.error=!1,n.disabled=!0,e.newFund(n.newfundForm)},n.fundQuery=function(){e.fundQuery(n.searchFund).then(function(e){n.fund=e})},n.getFund=function(){e.getFund().then(function(e){n.fundinfo=e.data})},n.getFund(),n.newFund=function(o,u,t,d,i,r,c,f){e.newFund(o,u,t,d,i,r,c,f).then(function(e){n.getFund()})},n.toggle=function(){n.showing=!n.showing},n.showing=!1}]),angular.module("SashasApp").directive("hideForm",function(){function n(n,e,o){var u=o.hideForm;n.$eval(u)||e.hide(),n.$watch(u,function(n,o){n!==o&&(n?e.stop(!0,!0).slideDown():e.stop(!0,!0).slideUp())})}return{link:n,restrict:"A"}});
angular.module("SashasApp").controller("mainController",["$scope","$state","$cookies","mainService",function(r,e,o,t){r.data=t.data,r.specificData=t.specificData,r.stockQuery="",r.mainService={},r.searchSymbols=function(){t.searchSymbols(r.stockQuery).then(function(r){t.data=r.data.ResultSet.Result,e.reload()})},r.getMoreInformation=function(r){t.getMoreInformation(r).then(function(r){t.specificData=r.data.query.results.quote,console.log(t.specificData),e.reload()})},r.addToPortfolio=function(r){var n=JSON.parse(o.get("currentUser"));console.log(n.portfolio);for(var s=0;s<n.portfolio.length;s++)if(r===JSON.parse(o.get("currentUser")).portfolio[s])return console.log("Already exists in portfolio"),!1;n.portfolio.push(r),o.remove("currentUser"),o.put("currentUser",JSON.stringify(n)),t.updateUser(n),t.getUserPortfolio(n.username).then(function(r){o.remove("currentUserPortfolio"),o.put("currentUserPortfolio",JSON.stringify(r.data))}),e.reload(),n=null},r.checkPortfolio=function(r){t.getUserPortfolio(JSON.parse(o.get("currentUser")).username).then(function(r){o.remove("currentUserPortfolio"),o.put("currentUserPortfolio",JSON.stringify(r.data))});for(var e=0;e<JSON.parse(o.get("currentUserPortfolio")).portfolio.length;e++)if(r===JSON.parse(o.get("currentUserPortfolio")).portfolio[e]._id)return!1;return!0},r.removeFromPortfolio=function(r){t.getUserPortfolio(JSON.parse(o.get("currentUser")).username).then(function(r){o.remove("currentUserPortfolio"),o.put("currentUserPortfolio",JSON.stringify(r.data))});for(var e=0;e<JSON.parse(o.get("currentUser")).portfolio.length;e++)if(console.log(JSON.parse(o.get("currentUser")).portfolio[e]),console.log(r),r===JSON.parse(o.get("currentUser")).portfolio[e]){var n=JSON.parse(o.get("currentUser"));console.log("this is user before",n),n.portfolio.splice(e,1),console.log("this is user after",n),t.updateUser(n).then(function(r){o.remove("currentUser"),o.put("currentUser",JSON.stringify(r.data)),console.log("response here",r.data)})}else console.log("Wasnt Found")}}]);
angular.module("SashasApp").controller("userController",["$scope","$state","$cookies","mainService",function(r,e,o,t){r.currentUserCookie=JSON.parse(o.get("currentUser")),r.$watch(r.currentUserCookie),r.currentUserPortfolioCookie=JSON.parse(o.get("currentUserPortfolio")),r.$watch(r.currentUserPortfolioCookie),r.checkPortfolio=function(r){for(var e=0;e<JSON.parse(o.get("currentUserPortfolio")).portfolio.length;e++)return r===JSON.parse(o.get("currentUserPortfolio")).portfolio[e]._id},r.removeFromPortfolio=function(r){if(console.log("length of thing",JSON.parse(o.get("currentUser")).portfolio.length),1===JSON.parse(o.get("currentUser")).portfolio.length){var s=JSON.parse(o.get("currentUser"));s.portfolio=[],o.remove("currentUser"),o.put("currentUser",JSON.stringify(s)),t.updateUser(s),console.log("hope this works"),t.getUserPortfolio(JSON.parse(o.get("currentUser")).username).then(function(r){o.remove("currentUserPortfolio"),o.put("currentUserPortfolio",JSON.stringify(r.data)),e.reload()})}t.getUserPortfolio(JSON.parse(o.get("currentUser")).username).then(function(r){o.remove("currentUserPortfolio"),o.put("currentUserPortfolio",JSON.stringify(r.data))});for(var n=0;n<JSON.parse(o.get("currentUser")).portfolio.length;n++)if(console.log(JSON.parse(o.get("currentUser")).portfolio[n]),console.log(r),r===JSON.parse(o.get("currentUser")).portfolio[n]){var l=JSON.parse(o.get("currentUser"));l.portfolio.splice(n,1),o.remove("currentUser"),o.put("currentUser",JSON.stringify(l)),t.updateUser(l),t.getUserPortfolio(JSON.parse(o.get("currentUser")).username).then(function(r){console.log("portfolio response here",r),o.remove("currentUserPortfolio"),o.put("currentUserPortfolio",JSON.stringify(r.data)),e.reload()})}else console.log("Wasnt Found")},r.checkUserCookie=function(){console.log("yes",JSON.parse(o.get("currentUser"))),console.log("hello",JSON.parse(o.get("currentUserPortfolio")))}}]);