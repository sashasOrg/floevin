angular.module("SashasApp",["ui.router","ngCookies"]),angular.module("SashasApp").config(["$stateProvider","$urlRouterProvider",function(t,r){t.state("home",{url:"/",templateUrl:"/home.html",controller:"mainController",access:{restricted:!1}}).state("form",{url:"/form",templateUrl:"/form.html",controller:"formController",access:{restricted:!1}}).state("login",{url:"/login",templateUrl:"/login.html",controller:"loginController",access:{restricted:!1}}).state("register",{url:"/register",templateUrl:"/register.html",controller:"registerController",access:{restricted:!1}}).state("portfolio",{url:"/portfolio",templateUrl:"/portfolio.html",controller:"userController",access:{restricted:!1}}).state("stock",{url:"/stock",templateUrl:"/stock.html",controller:"mainController",access:{restricted:!1}}).state("fundinfo",{url:"/fundinfo",templateUrl:"/fundinfo.html",controller:"formController",access:{restricted:!1}}).state("admin",{url:"/admin",templateUrl:"/admin.html",controller:"formController",access:{restricted:!1}}),r.otherwise("/")}]),angular.module("SashasApp").run(["$state","$rootScope","$location","AuthService",function(t,r,e,o){r.$on("$stateChangeStart",function(r,e,l){o.getUserStatus(),e.access.restricted&&!o.isLoggedIn()&&(r.preventDefault(),t.go("login"))})}]);
angular.module("SashasApp").controller("loginController",["$state","$scope","$location","$cookies","AuthService","mainService",function(e,r,o,n,t,i){r.isLoggedIn=t.isLoggedIn,r.login=function(){r.error=!1,r.disabled=!0,t.login(r.loginForm.username,r.loginForm.password).then(function(o){r.disabled=!1,r.loginForm={},t.isLoggedIn(),n.remove("currentUser"),n.put("currentUser",JSON.stringify(o)),i.getUserPortfolio(JSON.parse(n.get("currentUser")).username).then(function(r){console.log("response two",r),n.remove("currentUserPortfolio"),n.put("currentUserPortfolio",JSON.stringify(r.data)),e.go("portfolio")})})["catch"](function(){r.error=!0,r.errorMessage="Invalid username and/or password",r.disabled=!1,r.loginForm={}})}}]),angular.module("SashasApp").controller("logoutController",["$scope","$location","$cookies","AuthService","mainService",function(e,r,o,n,t){e.userLogged=n.isLoggedIn(),e.$watch(e.userLogged),e.logout=function(){n.logout().then(function(){o.remove("currentUser"),o.remove("currentUserPortfolio"),r.path("login")}),console.log("logout")}}]),angular.module("SashasApp").controller("registerController",["$scope","$location","AuthService",function(e,r,o){e.register=function(){e.error=!1,e.disabled=!0,o.register(e.registerForm.username,e.registerForm.password,e.registerForm.firstName,e.registerForm.lastName,e.registerForm.email).then(function(){r.path("login"),e.disabled=!1,e.registerForm={}})["catch"](function(){e.error=!0,e.errorMessage="Something went wrong!",e.disabled=!1,e.registerForm={}})}}]);
angular.module("SashasApp").controller("formController",["$scope","$cookies","formService",function(n,e,u){n.seachFund="",n.changeMutualFund=function(e){n.changedFund=e},n.updateMutualFund=function(e){u.updateFund(e._id,e).then(function(e){console.log("Success"),console.log(e),n.changedFund={}})["catch"](function(e){console.log("Error"),n.changedFund={}})},n.anyfund=function(){console.log("test"),n.error=!1,n.disabled=!0,u.newFund(n.newfundForm)},n.deleteFund=function(e){u.deleteFund(e).then(function(u){for(var o=0;o<n.fund.length;o++)e===n.fund[o]&&n.fund.splice(o,1)})},n.fundQuery=function(){u.fundQuery(n.searchFund).then(function(e){n.fund=e})},n.getFund=function(){u.getFund().then(function(e){n.fundinfo=e.data})},n.getFund(),n.newFund=function(e,o,t,d,c,i,f,r){u.newFund(e,o,t,d,c,i,f,r).then(function(e){n.getFund()})},n.toggle=function(){n.showing=!n.showing},n.showing=!1}]),angular.module("SashasApp").directive("hideForm",function(){function n(n,e,u){var o=u.hideForm;n.$eval(o)||e.hide(),n.$watch(o,function(n,u){n!==u&&(n?e.stop(!0,!0).slideDown():e.stop(!0,!0).slideUp())})}return{link:n,restrict:"A"}});
angular.module("SashasApp").controller("mainController",["$scope","$state","$cookies","mainService",function(r,e,o,t){r.data=t.data,r.specificData=t.specificData,r.stockQuery="",r.mainService={},r.searchSymbols=function(){t.searchSymbols(r.stockQuery).then(function(r){t.data=r.data.ResultSet.Result,e.reload()})},r.getMoreInformation=function(r){t.getMoreInformation(r).then(function(r){t.specificData=r.data.query.results.quote,console.log(t.specificData),e.reload()})},r.addToPortfolio=function(r){var n=JSON.parse(o.get("currentUser"));console.log(n.portfolio);for(var s=0;s<n.portfolio.length;s++)if(r===JSON.parse(o.get("currentUser")).portfolio[s])return console.log("Already exists in portfolio"),!1;n.portfolio.push(r),o.remove("currentUser"),o.put("currentUser",JSON.stringify(n)),t.updateUser(n),t.getUserPortfolio(n.username).then(function(r){o.remove("currentUserPortfolio"),o.put("currentUserPortfolio",JSON.stringify(r.data))}),e.reload(),n=null},r.checkPortfolio=function(r){t.getUserPortfolio(JSON.parse(o.get("currentUser")).username).then(function(r){o.remove("currentUserPortfolio"),o.put("currentUserPortfolio",JSON.stringify(r.data))});for(var e=0;e<JSON.parse(o.get("currentUserPortfolio")).portfolio.length;e++)if(r===JSON.parse(o.get("currentUserPortfolio")).portfolio[e]._id)return!1;return!0},r.removeFromPortfolio=function(r){t.getUserPortfolio(JSON.parse(o.get("currentUser")).username).then(function(r){o.remove("currentUserPortfolio"),o.put("currentUserPortfolio",JSON.stringify(r.data))});for(var e=0;e<JSON.parse(o.get("currentUser")).portfolio.length;e++)if(console.log(JSON.parse(o.get("currentUser")).portfolio[e]),console.log(r),r===JSON.parse(o.get("currentUser")).portfolio[e]){var n=JSON.parse(o.get("currentUser"));console.log("this is user before",n),n.portfolio.splice(e,1),console.log("this is user after",n),t.updateUser(n).then(function(r){o.remove("currentUser"),o.put("currentUser",JSON.stringify(r.data)),console.log("response here",r.data)})}else console.log("Wasnt Found")}}]);
angular.module("SashasApp").controller("userController",["$scope","$state","$cookies","mainService",function(r,e,o,t){r.currentUserCookie=JSON.parse(o.get("currentUser")),r.$watch(r.currentUserCookie),r.currentUserPortfolioCookie=JSON.parse(o.get("currentUserPortfolio")),r.$watch(r.currentUserPortfolioCookie),r.checkPortfolio=function(r){for(var e=0;e<JSON.parse(o.get("currentUserPortfolio")).portfolio.length;e++)return r===JSON.parse(o.get("currentUserPortfolio")).portfolio[e]._id},r.removeFromPortfolio=function(r){if(console.log("length of thing",JSON.parse(o.get("currentUser")).portfolio.length),1===JSON.parse(o.get("currentUser")).portfolio.length){var s=JSON.parse(o.get("currentUser"));s.portfolio=[],o.remove("currentUser"),o.put("currentUser",JSON.stringify(s)),t.updateUser(s),console.log("hope this works"),t.getUserPortfolio(JSON.parse(o.get("currentUser")).username).then(function(r){o.remove("currentUserPortfolio"),o.put("currentUserPortfolio",JSON.stringify(r.data)),e.reload()})}t.getUserPortfolio(JSON.parse(o.get("currentUser")).username).then(function(r){o.remove("currentUserPortfolio"),o.put("currentUserPortfolio",JSON.stringify(r.data))});for(var n=0;n<JSON.parse(o.get("currentUser")).portfolio.length;n++)if(console.log(JSON.parse(o.get("currentUser")).portfolio[n]),console.log(r),r===JSON.parse(o.get("currentUser")).portfolio[n]){var l=JSON.parse(o.get("currentUser"));l.portfolio.splice(n,1),o.remove("currentUser"),o.put("currentUser",JSON.stringify(l)),t.updateUser(l),t.getUserPortfolio(JSON.parse(o.get("currentUser")).username).then(function(r){console.log("portfolio response here",r),o.remove("currentUserPortfolio"),o.put("currentUserPortfolio",JSON.stringify(r.data)),e.reload()})}else console.log("Wasnt Found")},r.checkUserCookie=function(){console.log("yes",JSON.parse(o.get("currentUser"))),console.log("hello",JSON.parse(o.get("currentUserPortfolio")))}}]);
angular.module("SashasApp").factory("AuthService",["$q","$timeout","$http","$state","$cookies",function(e,r,s,t,u){function n(){return null===JSON.stringify(u.get("currentUser"))?user=null:user=!0,!!user}function o(){s.get("/user/status").success(function(e){e.status?user=!0:user=!1}).error(function(e){user=!1})}function c(r,t){var n=e.defer();return s.post("/user/login",{username:r,password:t}).success(function(e,r){200===r&&e.status?(user=!0,console.log(u.get("currentUser")),n.resolve(e.user)):(user=!1,n.reject())}).error(function(e){user=!1,n.reject()}),n.promise}function i(){var r=e.defer();return s.get("/user/logout").success(function(e){user=!1,u.remove("currentUser"),r.resolve()}).error(function(e){user=!1,r.reject()}),r.promise}function a(r,t,u,n,o){var c=e.defer();return s.post("/user/register",{username:r,password:t,firstName:u,lastName:n,email:o}).success(function(e,r){200===r&&e.status?c.resolve():c.reject()}).error(function(e){c.reject()}),c.promise}return this.currentUser=u.get("currentUser"),{isLoggedIn:n,getUserStatus:o,login:c,logout:i,register:a}}]);
angular.module("SashasApp").service("formService",["$http","$q","$cookies",function(n,u,t){this.getFund=function(){return n.get("/fund")},this.newFund=function(u){console.log(u),n.post("/fund",u)},this.fundQuery=function(u){return n.get("/fund/specific?id="+u)},this.updateFund=function(u,t){return n.put("/fund?id="+u,t)},this.deleteFund=function(u){return n["delete"]("/fund?id="+u)},this.updateFund=function(u,t){return n.put("/fund?id="+u,t)}}]);
angular.module("SashasApp").service("mainService",["$http","$q","$cookies",function(e,t,o){this.data=[],this.searchSymbols=function(t){return e.jsonp("http://d.yimg.com/aq/autoc?query="+t+"&region=US&lang=en-US&callback=JSON_CALLBACK")},this.getMoreInformation=function(t){return e.get("http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20IN%20(%22"+t+"%22,%22"+t+"%22)&format=json&env=http://datatables.org/alltables.env")},this.updateUser=function(t){return e.put("user?id="+JSON.parse(o.get("currentUser"))._id,t)},this.getUserPortfolio=function(t){return e.get("user/portfolio?username="+t)}}]);
angular.module("SashasApp").service("userService",["$http",function(e){}]);